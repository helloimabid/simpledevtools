<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <!-- Google Tag Manager -->
    <script>(function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-M2JM5FC3');</script>
    <!-- End Google Tag Manager -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Free online JSON Formatter, Validator & TypeScript Converter. Parse, validate, beautify, minify, and convert JSON to TypeScript instantly. Features Magic Fix, Tree View, and more. Client-side privacy focused.">
    <meta name="robots" content="index, follow">
    <title>JSON Formatter, Validator & TypeScript Converter – Free Online Tool</title>
    <meta name="google-adsense-account" content="ca-pub-9710571190649081">
    <link rel="canonical" href="https://simpledevtools.tech/json-formatter" />
    <script src="https://analytics.ahrefs.com/analytics.js" data-key="Hsz4y6HoB+jznDcQTkjyfg" async></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&amp;family=Space+Grotesk:wght@400;500;600&amp;family=JetBrains+Mono:wght@400;500&amp;display=swap"
        rel="stylesheet">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <script src="https://quge5.com/88/tag.min.js" data-zone="201790" async data-cfasync="false"></script>
    <!-- Tailwind CSS -->
  <link rel="stylesheet" href="./dist/output.css">

    <!-- Iconify/Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Dropdown Styles */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            z-index: 1000;
            min-width: 160px;
            background: white;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 6px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            margin-top: 4px;
        }

        .dark .dropdown-content {
            background: rgba(31, 41, 55, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(8px);
        }

        .dropdown:hover .dropdown-content,
        .dropdown:focus-within .dropdown-content {
            display: block;
        }

        .dropdown-content button {
            white-space: nowrap;
        }

        /* Enhanced Drag & Drop Styles */
        #drop-zone {
            transition: all 0.3s ease;
        }

        #drop-zone.drag-over {
            background: rgba(99, 102, 241, 0.05);
            border-color: rgba(99, 102, 241, 0.3);
        }

        .dark #drop-zone.drag-over {
            background: rgba(99, 102, 241, 0.1);
            border-color: rgba(99, 102, 241, 0.5);
        }

        #drag-overlay {
            animation: fadeIn 0.2s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .file-info {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            z-index: 10;
            display: none;
        }

        .drop-hint {
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(99, 102, 241, 0.9);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        #drop-zone:hover .drop-hint {
            opacity: 1;
        }

        /* Tree View Search Highlighting */
        .search-highlight {
            background-color: rgb(251 191 36);
            color: white;
            padding: 1px 2px;
            border-radius: 2px;
            font-weight: 500;
        }

        .dark .search-highlight {
            background-color: rgb(147 51 234);
            color: white;
        }

        .hidden-node {
            display: none !important;
        }
    </style>

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9710571190649081"
        crossorigin="anonymous"></script>
</head>

<body
    class="bg-white dark:bg-black text-neutral-900 dark:text-neutral-100 transition-colors duration-300 flex flex-col min-h-screen">

    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M2JM5FC3" height="0" width="0"
            style="display:none;visibility:hidden"></iframe></noscript>

    <noscript>
        <nav class="p-4 text-sm text-neutral-600 dark:text-neutral-400">
            <a href="/" class="underline">Home</a> |
            <a href="/tools" class="underline">Tools</a> |
            <a href="/privacy-policy" class="underline">Privacy</a> |
            <a href="/terms" class="underline">Terms</a>
        </nav>
    </noscript>

    <div class="fixed inset-0 z-0 bg-grid pointer-events-none opacity-60"></div>
    <div
        class="fixed top-0 left-1/2 -translate-x-1/2 w-[600px] h-[300px] bg-indigo-500/10 dark:bg-indigo-500/20 blur-[100px] rounded-full pointer-events-none z-0">
    </div>

    <!-- Main Content -->
    <main class="relative z-10 flex-grow pt-28 pb-20 px-4 sm:px-6">
        <div class="max-w-7xl mx-auto">

            <!-- Header Section -->
            <div class="text-center max-w-2xl mx-auto mb-12">
                <div
                    class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 dark:text-indigo-400 text-xs font-mono font-medium mb-6 border border-indigo-100 dark:border-indigo-900/30">
                    <i data-lucide="shield-check" class="w-3 h-3"></i>
                    <span>Processed locally. No data reaches our servers.</span>
                </div>
                <h1
                    class="font-display text-4xl sm:text-5xl font-semibold tracking-tight text-neutral-900 dark:text-white mb-4">
                    JSON Formatter & Converter
                </h1>
                <p class="text-neutral-500 dark:text-neutral-400 text-lg leading-relaxed">
                    Parse, validate, beautify, and convert JSON to TypeScript, YAML, and CSV instantly.
                </p>
                
                <!-- Guide Link -->
                <div class="mt-6 flex justify-center">
                    <a href="/guides/json-formatter-guide" class="inline-flex items-center gap-2 px-4 py-2 text-sm text-indigo-600 dark:text-indigo-400 hover:text-indigo-700 dark:hover:text-indigo-300 font-medium transition-colors">
                        <i data-lucide="book-open" class="w-4 h-4"></i>
                        View User Guide
                    </a>
                </div>
            </div>

            <!-- Tool Interface -->
            <div id="json-formatter"
                class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-xl shadow-sm overflow-hidden mb-16 animate-fade-in relative">

                <!-- Toolbar -->
                <div
                    class="border-b border-neutral-200 dark:border-neutral-800 p-3 bg-neutral-50/50 dark:bg-neutral-900/50 flex flex-wrap items-center justify-between gap-3">
                    <div class="flex flex-wrap items-center gap-2">
                        <!-- Primary Format Button -->
                        <button onclick="formatJSON(2)"
                            class="flex items-center gap-1.5 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 text-white text-xs font-medium rounded-md transition-colors shadow-sm">
                            <i data-lucide="play" class="w-3.5 h-3.5"></i>
                            Format / Validate
                        </button>

                        <div class="w-px h-6 bg-neutral-200 dark:bg-neutral-800 mx-1"></div>

                        <button onclick="formatJSON(2)"
                            class="flex items-center gap-1.5 px-3 py-1.5 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-50 dark:hover:bg-neutral-750 text-xs font-medium rounded-md transition-colors">
                            <i data-lucide="align-left" class="w-3.5 h-3.5"></i>
                            2 Spaces
                        </button>
                        <button onclick="formatJSON(4)"
                            class="flex items-center gap-1.5 px-3 py-1.5 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-50 dark:hover:bg-neutral-750 text-xs font-medium rounded-md transition-colors">
                            <i data-lucide="align-left" class="w-3.5 h-3.5"></i>
                            4 Spaces
                        </button>
                        <button onclick="minifyJSON()"
                            class="flex items-center gap-1.5 px-3 py-1.5 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-50 dark:hover:bg-neutral-750 text-xs font-medium rounded-md transition-colors">
                            <i data-lucide="minimize-2" class="w-3.5 h-3.5"></i>
                            Minify
                        </button>
                        <button onclick="magicFix()"
                            class="flex items-center gap-1.5 px-3 py-1.5 text-amber-700 dark:text-amber-400 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 hover:bg-amber-100 dark:hover:bg-amber-900/40 text-xs font-medium rounded-md transition-colors">
                            <i data-lucide="wand-2" class="w-3.5 h-3.5"></i>
                            Fix
                        </button>

                        <!-- Divider -->
                        <div class="w-px h-6 bg-neutral-200 dark:bg-neutral-800 mx-1"></div>

                        <!-- Convert Dropdown -->
                         
                        <div class="dropdown">
                            <button
                                class="flex items-center gap-1.5 px-3 py-1.5 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 text-neutral-600 dark:text-neutral-400 hover:text-indigo-600 dark:hover:text-indigo-400 hover:bg-neutral-50 dark:hover:bg-neutral-750 text-xs font-medium rounded-md transition-all">
                                <i data-lucide="arrow-right-left" class="w-3.5 h-3.5"></i>
                                Convert To...
                                <i data-lucide="chevron-down" class="w-3 h-3 ml-1"></i>
                            </button>
                            <div class="dropdown-content p-1">
                                <button onclick="jsonToTypeScript()"
                                    class="w-full text-left flex items-center gap-2 px-3 py-2 text-xs text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-800 rounded-sm">
                                    <i data-lucide="code-2" class="w-3.5 h-3.5"></i> TypeScript
                                </button>
                                <button onclick="jsonToYAML()"
                                    class="w-full text-left flex items-center gap-2 px-3 py-2 text-xs text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-800 rounded-sm">
                                    <i data-lucide="file-code" class="w-3.5 h-3.5"></i> YAML
                                </button>
                                <button onclick="jsonToCSV()"
                                    class="w-full text-left flex items-center gap-2 px-3 py-2 text-xs text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-800 rounded-sm">
                                    <i data-lucide="table" class="w-3.5 h-3.5"></i> CSV
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="flex flex-wrap items-center gap-2">
                        <button onclick="document.getElementById('file-upload').click()"
                            class="flex items-center gap-1.5 px-3 py-1.5 text-neutral-500 hover:text-indigo-600 dark:hover:text-indigo-400 text-xs font-medium transition-colors"
                            title="Upload File">
                            <i data-lucide="upload" class="w-3.5 h-3.5"></i>
                            Upload
                        </button>
                        <input type="file" id="file-upload" class="hidden" accept=".json,.txt"
                            onchange="handleFileUpload(this)">

                        <button onclick="loadSample()"
                            class="flex items-center gap-1.5 px-3 py-1.5 text-neutral-500 hover:text-indigo-600 dark:hover:text-indigo-400 text-xs font-medium transition-colors">
                            Sample
                        </button>
                        <button onclick="clearAll()"
                            class="flex items-center gap-1.5 px-3 py-1.5 text-neutral-500 hover:text-red-600 text-xs font-medium transition-colors">
                            <i data-lucide="trash-2" class="w-3.5 h-3.5"></i>
                            Clear
                        </button>
                        <button onclick="downloadOutput()"
                            class="flex items-center gap-1.5 px-3 py-1.5 bg-neutral-900 dark:bg-white hover:bg-neutral-800 dark:hover:bg-neutral-200 text-white dark:text-neutral-900 text-xs font-medium rounded-md transition-colors shadow-sm">
                            <i data-lucide="download" class="w-3.5 h-3.5"></i>
                            Save
                        </button>
                    </div>
                </div>

                <!-- Editor Area -->
                <div
                    class="grid grid-cols-1 lg:grid-cols-2 divide-y lg:divide-y-0 lg:divide-x divide-neutral-200 dark:divide-neutral-800 h-[600px]">
                    <!-- Input -->
                    <div class="flex flex-col h-full relative group" id="drop-zone">
                        <div
                            class="px-4 py-2 bg-neutral-50/30 dark:bg-neutral-900/30 border-b border-neutral-100 dark:border-neutral-800 text-xs font-mono text-neutral-500 flex justify-between items-center shrink-0">
                            <span class="flex items-center gap-2">
                                Input
                                <span
                                    class="px-1.5 py-0.5 rounded bg-neutral-100 dark:bg-neutral-800 text-[10px] text-neutral-400">JSON</span>
                                <!-- Realtime Status Indicator -->
                                <span id="realtime-status" class="hidden flex items-center gap-1 ml-2 transition-all">
                                    <i data-lucide="check-circle-2" class="w-3.5 h-3.5 text-emerald-500"></i>
                                    <span class="text-emerald-600 dark:text-emerald-400 font-medium">Valid</span>
                                </span>
                            </span>
                            <div class="flex items-center gap-3">
                                <span id="auto-save-indicator"
                                    class="opacity-0 transition-opacity duration-300 text-[10px] text-emerald-500 flex items-center gap-1">
                                    <i data-lucide="save" class="w-3 h-3"></i> Saved
                                </span>
                                <span id="input-stats">0 chars</span>
                            </div>
                        </div>

                        <!-- Top Error Banner -->
                        <div id="top-error-banner"
                            class="hidden bg-red-50 dark:bg-red-900/20 border-b border-red-100 dark:border-red-900/50 p-3 animate-fade-in shrink-0">
                            <div class="flex items-start gap-2">
                                <i data-lucide="alert-circle"
                                    class="w-4 h-4 text-red-600 dark:text-red-400 mt-0.5 shrink-0"></i>
                                <div class="flex-1 min-w-0">
                                    <p class="text-xs font-medium text-red-800 dark:text-red-300">Syntax Error</p>
                                    <p id="top-error-message"
                                        class="text-[11px] text-red-600 dark:text-red-400 font-mono mt-0.5 break-all line-clamp-2">
                                    </p>
                                </div>
                                <button onclick="dismissError()"
                                    class="text-red-400 hover:text-red-600 dark:hover:text-red-300">
                                    <i data-lucide="x" class="w-3.5 h-3.5"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Drag & Drop Overlay -->
                        <div id="drag-overlay"
                            class="absolute inset-2 z-20 hidden flex-col items-center justify-center bg-indigo-50/90 dark:bg-indigo-900/90 backdrop-blur-sm rounded-lg pointer-events-none transition-all">
                            <i data-lucide="file-up" class="w-10 h-10 text-indigo-500 mb-2"></i>
                            <p class="text-sm font-medium text-indigo-700 dark:text-indigo-300">Drop JSON file here</p>
                            <p class="text-xs text-indigo-600 dark:text-indigo-400 mt-1">Supports .json, .txt files</p>
                        </div>

                        <!-- File Info Display -->
                        <div id="file-info" class="file-info">
                            <span id="file-name">filename.json</span> • <span id="file-size">0 KB</span>
                        </div>

                        <!-- Drop Hint -->
                        <div class="drop-hint">
                            <i data-lucide="upload" class="w-3 h-3 inline mr-1"></i>
                            Drag & drop files here
                        </div>

                        <textarea id="json-input"
                            class="flex-1 w-full p-4 bg-transparent border-2 border-transparent focus:ring-0 text-xs sm:text-sm font-mono text-neutral-800 dark:text-neutral-200 resize-none outline-none placeholder:text-neutral-400/50 leading-relaxed transition-colors"
                            placeholder="Paste JSON here, or drag & drop a file..." spellcheck="false"></textarea>
                    </div>

                    <!-- Output -->
                    <div class="flex flex-col h-full bg-neutral-50/20 dark:bg-black/20 relative">
                        <div
                            class="px-4 py-2 bg-neutral-50/30 dark:bg-neutral-900/30 border-b border-neutral-100 dark:border-neutral-800 flex justify-between items-center">
                            <div class="flex gap-2">
                                <button onclick="switchView('text')" id="tab-text"
                                    class="text-xs font-mono font-bold text-neutral-900 dark:text-white px-2 py-0.5 rounded bg-white dark:bg-neutral-800 shadow-sm transition-all border border-neutral-200 dark:border-neutral-700">Text</button>
                                <button onclick="switchView('tree')" id="tab-tree"
                                    class="text-xs font-mono text-neutral-500 hover:text-neutral-900 dark:hover:text-white px-2 py-0.5 transition-all border border-transparent">Tree</button>
                            </div>

                            <!-- Tree View Controls (Hidden by default) -->
                            <div id="tree-controls"
                                class="hidden flex items-center gap-2 mr-auto ml-4 border-l border-neutral-200 dark:border-neutral-700 pl-4">
                                <div class="relative">
                                    <i data-lucide="search"
                                        class="absolute left-2 top-1/2 -translate-y-1/2 w-3 h-3 text-neutral-400"></i>
                                    <input type="text" id="tree-search" placeholder="Filter..."
                                        oninput="filterTree(this.value)"
                                        class="w-24 focus:w-40 transition-all pl-7 pr-2 py-0.5 text-xs bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-md focus:outline-none focus:ring-1 focus:ring-indigo-500 dark:text-white placeholder:text-neutral-400">
                                </div>
                                <button onclick="expandAll()"
                                    class="p-1 hover:bg-neutral-200 dark:hover:bg-neutral-700 rounded text-neutral-500"
                                    title="Expand All">
                                    <i data-lucide="chevrons-down-up" class="w-3.5 h-3.5"></i>
                                </button>
                                <button onclick="collapseAll()"
                                    class="p-1 hover:bg-neutral-200 dark:hover:bg-neutral-700 rounded text-neutral-500"
                                    title="Collapse All">
                                    <i data-lucide="chevrons-up-down" class="w-3.5 h-3.5"></i>
                                </button>
                            </div>

                            <div class="flex items-center gap-2">
                                <span id="status-badge"
                                    class="hidden text-[10px] uppercase font-bold tracking-wider px-2 py-0.5 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400">Valid</span>
                                <span id="format-badge"
                                    class="hidden text-[10px] uppercase font-bold tracking-wider px-2 py-0.5 rounded-full bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400">JSON</span>
                                <button onclick="copyOutput()" id="copy-btn"
                                    class="text-neutral-400 hover:text-neutral-900 dark:hover:text-white transition-colors p-1 rounded-md hover:bg-neutral-100 dark:hover:bg-neutral-800"
                                    title="Copy to Clipboard">
                                    <i data-lucide="copy" class="w-3.5 h-3.5"></i>
                                </button>
                            </div>
                        </div>

                        <div class="relative flex-1 overflow-hidden">
                            <!-- Text View -->
                            <textarea id="json-output" readonly
                                class="w-full h-full p-4 bg-transparent border-0 focus:ring-0 text-xs sm:text-sm font-mono text-neutral-700 dark:text-neutral-300 resize-none outline-none leading-relaxed"
                                placeholder="Result will appear here..."></textarea>

                            <!-- Tree View (Hidden by default) -->
                            <div id="json-tree-view"
                                class="hidden w-full h-full p-4 overflow-auto bg-transparent scrollbar-thin">
                                <div class="text-neutral-400 italic text-center mt-20 text-xs">Parse JSON to view tree
                                    structure</div>
                            </div>

                            <!-- Error Box Removed (Moved to top) -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- New educational SEO section: The Modern Language of Data -->
            <section class="mt-20 pt-16 border-t border-neutral-200 dark:border-neutral-800">
                <article class="prose prose-neutral dark:prose-invert max-w-none">
                    <h2 class="font-display text-3xl font-semibold mb-4 text-neutral-900 dark:text-white">The Modern
                        Language of
                        Data: A Deep Dive into JSON</h2>
                    <p class="text-neutral-600 dark:text-neutral-400 text-lg leading-relaxed mb-8">
                        If you've ever worked with APIs or exchanged data between applications, you've encountered
                        <strong>JSON</strong>. Pronounced like the name "Jason," JSON has become the world's most
                        beloved data
                        interchange format. But what makes it so special? Let's explore this essential technology that
                        powers
                        modern web development.
                    </p>

                    <!-- What is JSON Section -->
                    <h3 class="font-display text-2xl font-semibold mt-12 mb-4 text-neutral-900 dark:text-white">What is
                        JSON?
                    </h3>
                    <p class="text-neutral-600 dark:text-neutral-400 mb-4">
                        <strong>JSON</strong> stands for JavaScript Object Notation. Created in 2001 by Douglas
                        Crockford, it's
                        a minimalist, text-based format designed for lightweight data exchange between servers and
                        clients.
                        While inspired by JavaScript syntax, JSON is completely language-independent.
                    </p>
                    <div
                        class="bg-indigo-50 dark:bg-indigo-900/10 border border-indigo-200 dark:border-indigo-900/30 rounded-lg p-6 not-prose mb-6">
                        <h4 class="font-medium text-neutral-900 dark:text-white mb-3">Design Principles:</h4>
                        <ul class="text-sm text-neutral-600 dark:text-neutral-400 space-y-2">
                            <li class="flex items-start gap-2"><span
                                    class="text-indigo-600 dark:text-indigo-400 font-bold">•</span> <span>Minimal and
                                    textual—no
                                    unnecessary complexity</span></li>
                            <li class="flex items-start gap-2"><span
                                    class="text-indigo-600 dark:text-indigo-400 font-bold">•</span> <span>Easy for
                                    humans to
                                    read and write</span></li>
                            <li class="flex items-start gap-2"><span
                                    class="text-indigo-600 dark:text-indigo-400 font-bold">•</span> <span>Simple for
                                    machines to
                                    parse and generate</span></li>
                            <li class="flex items-start gap-2"><span
                                    class="text-indigo-600 dark:text-indigo-400 font-bold">•</span> <span>Avoids feature
                                    creep
                                    to remain stable—it doesn't even have a version number</span></li>
                        </ul>
                    </div>

                    <!-- JSON Structure Section -->
                    <h3 class="font-display text-2xl font-semibold mt-10 mb-4 text-neutral-900 dark:text-white">The
                        Blueprint:
                        How JSON is Structured</h3>
                    <p class="text-neutral-600 dark:text-neutral-400 mb-6">
                        JSON is built on two universal structures that virtually all programming languages understand:
                    </p>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 not-prose mb-6">
                        <div
                            class="bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5">
                            <h4 class="font-semibold text-neutral-900 dark:text-white mb-3 flex items-center gap-2">
                                <span class="text-lg text-fuchsia-500">{}</span> Objects
                            </h4>
                            <p class="text-sm text-neutral-600 dark:text-neutral-400 mb-3">An unordered collection of
                                key-value
                                pairs enclosed in curly braces.</p>
                            <code
                                class="text-xs bg-white dark:bg-black p-2 rounded block font-mono text-emerald-600 dark:text-emerald-400 overflow-x-auto">{"name": "John", "age": 30}</code>
                            <p class="text-xs text-neutral-500 dark:text-neutral-500 mt-2 italic">Keys must always be
                                strings in
                                double quotes</p>
                        </div>
                        <div
                            class="bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-5">
                            <h4 class="font-semibold text-neutral-900 dark:text-white mb-3 flex items-center gap-2">
                                <span class="text-lg text-blue-500">[]</span> Arrays
                            </h4>
                            <p class="text-sm text-neutral-600 dark:text-neutral-400 mb-3">An ordered list of values
                                enclosed in
                                square brackets.</p>
                            <code
                                class="text-xs bg-white dark:bg-black p-2 rounded block font-mono text-blue-600 dark:text-blue-400 overflow-x-auto">["apple", "banana", 42]</code>
                            <p class="text-xs text-neutral-500 dark:text-neutral-500 mt-2 italic">Can contain any valid
                                JSON
                                values</p>
                        </div>
                    </div>

                    <!-- Data Types Section -->
                    <h3 class="font-display text-2xl font-semibold mt-10 mb-4 text-neutral-900 dark:text-white">The 6
                        JSON Data
                        Types</h3>
                    <p class="text-neutral-600 dark:text-neutral-400 mb-6">
                        JSON supports these core data types, ensuring compatibility across all programming languages:
                    </p>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 not-prose mb-8">
                        <div
                            class="flex items-start gap-3 p-3 rounded-lg bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800">
                            <span
                                class="font-mono text-sm font-bold text-emerald-600 dark:text-emerald-400 mt-0.5">1</span>
                            <div>
                                <h5 class="font-medium text-neutral-900 dark:text-white text-sm">String</h5>
                                <p class="text-xs text-neutral-500">Unicode characters in double quotes</p>
                            </div>
                        </div>
                        <div
                            class="flex items-start gap-3 p-3 rounded-lg bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800">
                            <span class="font-mono text-sm font-bold text-blue-600 dark:text-blue-400 mt-0.5">2</span>
                            <div>
                                <h5 class="font-medium text-neutral-900 dark:text-white text-sm">Number</h5>
                                <p class="text-xs text-neutral-500">Integers and decimals (no NaN or Infinity)</p>
                            </div>
                        </div>
                        <div
                            class="flex items-start gap-3 p-3 rounded-lg bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800">
                            <span class="font-mono text-sm font-bold text-red-600 dark:text-red-400 mt-0.5">3</span>
                            <div>
                                <h5 class="font-medium text-neutral-900 dark:text-white text-sm">Boolean</h5>
                                <p class="text-xs text-neutral-500">true or false</p>
                            </div>
                        </div>
                        <div
                            class="flex items-start gap-3 p-3 rounded-lg bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800">
                            <span class="font-mono text-sm font-bold text-gray-600 dark:text-gray-400 mt-0.5">4</span>
                            <div>
                                <h5 class="font-medium text-neutral-900 dark:text-white text-sm">Null</h5>
                                <p class="text-xs text-neutral-500">Represents an empty value</p>
                            </div>
                        </div>
                        <div
                            class="flex items-start gap-3 p-3 rounded-lg bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800">
                            <span
                                class="font-mono text-sm font-bold text-fuchsia-600 dark:text-fuchsia-400 mt-0.5">5</span>
                            <div>
                                <h5 class="font-medium text-neutral-900 dark:text-white text-sm">Object</h5>
                                <p class="text-xs text-neutral-500">Nested structures allowed</p>
                            </div>
                        </div>
                        <div
                            class="flex items-start gap-3 p-3 rounded-lg bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800">
                            <span
                                class="font-mono text-sm font-bold text-indigo-600 dark:text-indigo-400 mt-0.5">6</span>
                            <div>
                                <h5 class="font-medium text-neutral-900 dark:text-white text-sm">Array</h5>
                                <p class="text-xs text-neutral-500">Lists within lists</p>
                            </div>
                        </div>
                    </div>

                    <!-- JSON vs XML Section -->
                    <h3 class="font-display text-2xl font-semibold mt-10 mb-4 text-neutral-900 dark:text-white">JSON vs
                        XML: Why
                        JSON Won</h3>
                    <p class="text-neutral-600 dark:text-neutral-400 mb-6">
                        Before JSON dominated, XML was the standard for data exchange. However, JSON offers significant
                        advantages:
                    </p>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 not-prose mb-8">
                        <div
                            class="bg-emerald-50 dark:bg-emerald-900/10 border border-emerald-200 dark:border-emerald-900/30 rounded-lg p-4">
                            <h5
                                class="font-semibold text-emerald-900 dark:text-emerald-100 mb-2 flex items-center gap-2">
                                <i data-lucide="zap" class="w-4 h-4"></i> Bandwidth
                            </h5>
                            <p class="text-sm text-emerald-800 dark:text-emerald-200">JSON is much more compact, using
                                less
                                bandwidth and loading faster on mobile networks.</p>
                        </div>
                        <div
                            class="bg-blue-50 dark:bg-blue-900/10 border border-blue-200 dark:border-blue-900/30 rounded-lg p-4">
                            <h5 class="font-semibold text-blue-900 dark:text-blue-100 mb-2 flex items-center gap-2">
                                <i data-lucide="cpu" class="w-4 h-4"></i> Parsing Speed
                            </h5>
                            <p class="text-sm text-blue-800 dark:text-blue-200">Browsers parse JSON natively with
                                JavaScript,
                                whereas XML requires complex DOM operations.</p>
                        </div>
                        <div
                            class="bg-violet-50 dark:bg-violet-900/10 border border-violet-200 dark:border-violet-900/30 rounded-lg p-4">
                            <h5 class="font-semibold text-violet-900 dark:text-violet-100 mb-2 flex items-center gap-2">
                                <i data-lucide="code" class="w-4 h-4"></i> Direct Mapping
                            </h5>
                            <p class="text-sm text-violet-800 dark:text-violet-200">JSON maps directly to objects and
                                arrays in
                                code, whereas XML has no natural mapping.</p>
                        </div>
                    </div>

                    <!-- JSON Parse and Stringify Section -->
                    <h3 class="font-display text-2xl font-semibold mt-10 mb-4 text-neutral-900 dark:text-white">JSON
                        Parse &
                        Stringify: Core Operations</h3>
                    <p class="text-neutral-600 dark:text-neutral-400 mb-6">
                        Two essential operations power JSON in every application:
                    </p>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 not-prose mb-8">
                        <div class="border-l-4 border-indigo-500 bg-indigo-50 dark:bg-indigo-900/10 p-5 rounded-lg">
                            <h5 class="font-semibold text-neutral-900 dark:text-white mb-2">JSON.stringify()</h5>
                            <p class="text-sm text-neutral-600 dark:text-neutral-400 mb-3">Converts a JavaScript object
                                into a
                                JSON string for transmission or storage.</p>
                            <code
                                class="text-xs bg-white dark:bg-black p-2 rounded block font-mono text-emerald-600 dark:text-emerald-400 mb-2">const json = JSON.stringify({name: "John"})</code>
                            <p class="text-xs text-neutral-500">Result: <code
                                    class="bg-white dark:bg-black p-1 rounded">{"name":"John"}</code></p>
                        </div>
                        <div class="border-l-4 border-emerald-500 bg-emerald-50 dark:bg-emerald-900/10 p-5 rounded-lg">
                            <h5 class="font-semibold text-neutral-900 dark:text-white mb-2">JSON.parse()</h5>
                            <p class="text-sm text-neutral-600 dark:text-neutral-400 mb-3">Converts a JSON string back
                                into a
                                usable JavaScript object.</p>
                            <code
                                class="text-xs bg-white dark:bg-black p-2 rounded block font-mono text-blue-600 dark:text-blue-400 mb-2">const obj = JSON.parse(jsonString)</code>
                            <p class="text-xs text-neutral-500">Result: Accessible as <code
                                    class="bg-white dark:bg-black p-1 rounded">obj.name</code></p>
                        </div>
                    </div>

                    <!-- JSON Validator & Best Practices -->
                    <h3 class="font-display text-2xl font-semibold mt-10 mb-4 text-neutral-900 dark:text-white">
                        Validation &
                        Security Best Practices</h3>
                    <p class="text-neutral-600 dark:text-neutral-400 mb-6">
                        A <a href="#json-formatter"
                            class="text-indigo-600 dark:text-indigo-400 hover:underline font-medium">JSON validator</a>
                        is
                        essential for ensuring data integrity and security. Always validate incoming JSON to prevent
                        injection
                        attacks and data corruption.
                    </p>

                    <div
                        class="bg-amber-50 dark:bg-amber-900/10 border border-amber-200 dark:border-amber-900/30 rounded-lg p-6 not-prose mb-8">
                        <h5 class="font-semibold text-amber-900 dark:text-amber-100 mb-3 flex items-center gap-2">
                            <i data-lucide="shield-alert" class="w-5 h-5"></i> Security Tips
                        </h5>
                        <ul class="text-sm text-amber-800 dark:text-amber-200 space-y-2">
                            <li class="flex items-start gap-2"><span class="font-bold">•</span> <span>Always use a <a
                                        class="text-indigo-600 dark:text-indigo-400 hover:underline font-medium"
                                        href="/json-formatter"><strong>JSON validator</strong></a> before processing
                                    untrusted data</span></li>
                            <li class="flex items-start gap-2"><span class="font-bold">•</span> <span>Implement
                                    server-side
                                    validation to prevent JSON injection attacks</span></li>
                            <li class="flex items-start gap-2"><span class="font-bold">•</span> <span>Never use
                                    <code>eval()</code> to parse JSON—always use <code>JSON.parse()</code></span></li>
                            <li class="flex items-start gap-2"><span class="font-bold">•</span> <span>Sanitize user
                                    input before
                                    converting to JSON strings</span></li>
                        </ul>
                    </div>

                    <!-- Advanced JSON Uses -->
                    <h3 class="font-display text-2xl font-semibold mt-10 mb-4 text-neutral-900 dark:text-white">Advanced
                        JSON
                        Applications</h3>
                    <p class="text-neutral-600 dark:text-neutral-400 mb-6">
                        JSON has evolved far beyond simple data exchange. Here are specialized formats built on JSON:
                    </p>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 not-prose mb-8">
                        <div
                            class="bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-4">
                            <h5 class="font-semibold text-neutral-900 dark:text-white mb-2">JWT</h5>
                            <p class="text-xs text-neutral-600 dark:text-neutral-400 mb-3">JSON Web Tokens for secure
                                authentication and authorization in APIs.</p>
                            <span
                                class="inline-block text-xs font-mono bg-indigo-100 dark:bg-indigo-900 text-indigo-700 dark:text-indigo-200 px-2 py-1 rounded">Authentication</span>
                        </div>
                        <div
                            class="bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-4">
                            <h5 class="font-semibold text-neutral-900 dark:text-white mb-2">JSON-LD</h5>
                            <p class="text-xs text-neutral-600 dark:text-neutral-400 mb-3">Linked Data format for SEO
                                and
                                structured data on the web.</p>
                            <span
                                class="inline-block text-xs font-mono bg-emerald-100 dark:bg-emerald-900 text-emerald-700 dark:text-emerald-200 px-2 py-1 rounded">SEO</span>
                        </div>
                        <div
                            class="bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-4">
                            <h5 class="font-semibold text-neutral-900 dark:text-white mb-2">GeoJSON</h5>
                            <p class="text-xs text-neutral-600 dark:text-neutral-400 mb-3">Represents geographic
                                features like
                                coordinates and polygons.</p>
                            <span
                                class="inline-block text-xs font-mono bg-violet-100 dark:bg-violet-900 text-violet-700 dark:text-violet-200 px-2 py-1 rounded">Mapping</span>
                        </div>
                    </div>

                    <!-- Infographic Section -->
                    <h3 class="font-display text-2xl font-semibold mt-10 mb-6 text-neutral-900 dark:text-white">JSON:
                        The
                        Universal Language of Data</h3>
                    <div
                        class="rounded-lg overflow-hidden border border-neutral-200 dark:border-neutral-800 bg-neutral-50 dark:bg-neutral-900/50">
                        <img src="https://i.ibb.co.com/0yyKLfPZ/json-universal-language-of-data-infographic.png"
                            alt="JSON: The Universal Language of Data infographic showing statistics about JSON efficiency, file sizes, and parsing speeds"
                            class="w-full  h-auto" loading="lazy">
                    </div>

                    <!-- Conclusion -->
                    <p class="text-neutral-600 dark:text-neutral-400 mt-8 text-base leading-relaxed">
                        <strong>JSON</strong> has become the de facto standard for data interchange because of its
                        simplicity,
                        efficiency, and universal support. Whether you're building REST APIs, configuring cloud
                        services, or
                        exchanging data between microservices, understanding JSON—and using the right <a
                            href="#json-formatter"
                            class="text-indigo-600 dark:text-indigo-400 hover:underline font-medium">JSON formatter</a>
                        tools—is
                        essential for modern development.
                    </p>
                </article>
            </section>
        </div>

    </main>


    <script src="layout.js"></script>

    <script>
        // State Management
        let currentMode = 'json'; // json, ts, yaml, csv
        const inputArea = document.getElementById('json-input');
        const outputArea = document.getElementById('json-output');
        const dropZone = document.getElementById('drop-zone');
        let debounceTimer;

        // Initialization
        window.onload = function () {
            lucide.createIcons();
            loadFromStorage();
        }

        // --- Realtime Validation ---
        function validateLive(value) {
            const statusEl = document.getElementById('realtime-status');
            const inputEl = document.getElementById('json-input');

            if (!value.trim()) {
                statusEl.classList.add('hidden');
                inputEl.classList.remove('valid-json', 'invalid-json');
                dismissError();
                return;
            }

            try {
                JSON.parse(value);
                // Valid
                statusEl.classList.remove('hidden');
                statusEl.innerHTML = '<i data-lucide="check-circle-2" class="w-3.5 h-3.5 text-emerald-500"></i><span class="text-emerald-600 dark:text-emerald-400 font-medium">Valid</span>';
                inputEl.classList.remove('invalid-json');
                inputEl.classList.add('valid-json');
                dismissError();
            } catch (e) {
                // Invalid
                statusEl.classList.remove('hidden');
                statusEl.innerHTML = '<i data-lucide="alert-circle" class="w-3.5 h-3.5 text-red-500"></i><span class="text-red-600 dark:text-red-400 font-medium">Invalid</span>';
                inputEl.classList.remove('valid-json');
                inputEl.classList.add('invalid-json');

                // Show error message on top (Realtime)
                showError(e.message, true);
            }
            lucide.createIcons();
        }

        // --- Core Formatting & Conversion ---

        function formatJSON(indent = 2) {
            currentMode = 'json';
            const input = inputArea.value.trim();
            if (!input) {
                showError('Please paste JSON first');
                return;
            }
            try {
                const parsed = JSON.parse(input);
                const formatted = JSON.stringify(parsed, null, indent);
                displayOutput(formatted, 'JSON');
                updateStats();
                saveToStorage();

                // If tree view is active, update it
                if (!document.getElementById('json-tree-view').classList.contains('hidden')) {
                    renderTree(formatted);
                }

                // Explicitly valid state
                validateLive(formatted);
            } catch (e) {
                showError(e.message);
            }
        }

        function minifyJSON() {
            currentMode = 'json';
            const input = inputArea.value.trim();
            if (!input) return showError('Please paste JSON first');
            try {
                const parsed = JSON.parse(input);
                const minified = JSON.stringify(parsed);
                displayOutput(minified, 'JSON');
                updateStats();
                saveToStorage();
            } catch (e) {
                showError(e.message);
            }
        }

        function magicFix() {
            let input = inputArea.value;
            // Common fixes
            input = input.replace(/,\s*}/g, '}').replace(/,\s*\]/g, ']'); // Trailing commas
            input = input.replace(/'/g, '"'); // Single quotes to double
            input = input.replace(/(\w+):/g, '"$1":'); // Unquoted keys
            inputArea.value = input;
            formatJSON(2);
        }

        function jsonToTypeScript() {
            const input = inputArea.value.trim();
            if (!input) return showError('Please paste JSON first');
            try {
                const parsed = JSON.parse(input);
                const typescript = generateTypeScriptInterface(parsed);
                displayOutput(typescript, 'TypeScript');
                currentMode = 'ts';
                switchView('text'); // Force text view for TS
            } catch (e) {
                showError('Invalid JSON: ' + e.message);
            }
        }

        function jsonToYAML() {
            const input = inputArea.value.trim();
            if (!input) return showError('Please paste JSON first');
            try {
                const parsed = JSON.parse(input);
                const yaml = toYAML(parsed);
                displayOutput(yaml, 'YAML');
                currentMode = 'yaml';
                switchView('text');
            } catch (e) {
                showError('Invalid JSON: ' + e.message);
            }
        }

        function jsonToCSV() {
            const input = inputArea.value.trim();
            if (!input) return showError('Please paste JSON first');
            try {
                const parsed = JSON.parse(input);
                const csv = toCSV(parsed);
                displayOutput(csv, 'CSV');
                currentMode = 'csv';
                switchView('text');
            } catch (e) {
                showError('Conversion Error: ' + e.message);
            }
        }

        // --- Helper Generators ---

        function toYAML(obj, indent = 0) {
            const spacing = '  '.repeat(indent);
            let yaml = '';

            if (obj === null) return 'null';
            if (typeof obj !== 'object') return String(obj);

            if (Array.isArray(obj)) {
                if (obj.length === 0) return '[]';
                obj.forEach(item => {
                    if (typeof item === 'object' && item !== null) {
                        yaml += `${spacing}- \n${toYAML(item, indent + 1).replace(/^/gm, '  ')}`;
                    } else {
                        yaml += `${spacing}- ${item}\n`;
                    }
                });
                return simpleYAML(obj, indent);
            }

            return simpleYAML(obj, indent);
        }

        function simpleYAML(data, indentLevel = 0) {
            let output = "";
            const indent = "  ".repeat(indentLevel);

            if (Array.isArray(data)) {
                data.forEach(item => {
                    if (typeof item === 'object' && item !== null) {
                        output += `${indent}-\n${simpleYAML(item, indentLevel + 1)}`;
                    } else {
                        output += `${indent}- ${item}\n`;
                    }
                });
            } else if (typeof data === 'object' && data !== null) {
                Object.keys(data).forEach(key => {
                    const value = data[key];
                    if (typeof value === 'object' && value !== null) {
                        if (Array.isArray(value) && value.length === 0) {
                            output += `${indent}${key}: []\n`;
                        } else if (Object.keys(value).length === 0) {
                            output += `${indent}${key}: {}\n`;
                        } else {
                            output += `${indent}${key}:\n${simpleYAML(value, indentLevel + 1)}`;
                        }
                    } else {
                        output += `${indent}${key}: ${value}\n`;
                    }
                });
            } else {
                output += `${indent}${data}\n`;
            }
            return output;
        }

        function toCSV(obj) {
            let array = Array.isArray(obj) ? obj : [obj];
            if (array.length === 0) return '';

            // Flatten objects
            const flatten = (data, prefix = '') => {
                let result = {};
                for (const key in data) {
                    if (typeof data[key] === 'object' && data[key] !== null) {
                        const flatObject = flatten(data[key], prefix + key + '.');
                        result = { ...result, ...flatObject };
                    } else {
                        result[prefix + key] = data[key];
                    }
                }
                return result;
            };

            const flatArray = array.map(item => flatten(item));

            // Get all unique headers
            const headers = Array.from(new Set(flatArray.flatMap(Object.keys)));

            const csvRows = [
                headers.join(','),
                ...flatArray.map(row => headers.map(header => {
                    const val = row[header] === undefined ? '' : row[header];
                    return JSON.stringify(val).replace(/\\"/g, '""'); // Handle quotes
                }).join(','))
            ];

            return csvRows.join('\n');
        }

        function generateTypeScriptInterface(obj, name = 'Root', indent = '') {
            let ts = '';
            if (indent === '') ts += `interface ${name} {\n`;

            for (const [key, value] of Object.entries(obj)) {
                const type = getTypeScriptType(value);
                const safeKey = /^[a-zA-Z_$][a-zA-Z0-9_$]*$/.test(key) ? key : `"${key}"`;
                ts += `${indent}  ${safeKey}: ${type};\n`;
            }

            if (indent === '') ts += `}\n`;
            return ts;
        }

        function getTypeScriptType(value) {
            if (value === null) return 'null';
            if (Array.isArray(value)) {
                if (value.length === 0) return 'any[]';
                const type = getTypeScriptType(value[0]);
                return `${type}[]`;
            }
            if (typeof value === 'object') {
                return `{ ${Object.keys(value).map(k => `${k}: ${getTypeScriptType(value[k])}`).join('; ')} }`;
            }
            return typeof value;
        }

        // --- Interaction & Storage ---

        function saveToStorage() {
            localStorage.setItem('json_input_backup', inputArea.value);
            const indicator = document.getElementById('auto-save-indicator');
            indicator.classList.remove('opacity-0');
            setTimeout(() => indicator.classList.add('opacity-0'), 2000);
        }

        function loadFromStorage() {
            const saved = localStorage.getItem('json_input_backup');
            if (saved) {
                inputArea.value = saved;
                updateStats();
                // Trigger debounce validation
                validateLive(saved);
            }
        }

        inputArea.addEventListener('input', () => {
            updateStats();

            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                validateLive(inputArea.value);
                saveToStorage();
            }, 300); // 300ms debounce
        });

        function handleFileUpload(input) {
            const file = input.files[0];
            if (!file) return;
            readFile(file);
        }

        function readFile(file) {
            const reader = new FileReader();
            
            // Show file info
            const fileInfo = document.getElementById('file-info');
            const fileName = document.getElementById('file-name');
            const fileSize = document.getElementById('file-size');
            
            fileName.textContent = file.name;
            fileSize.textContent = formatFileSize(file.size);
            fileInfo.style.display = 'block';
            
            // Validate file type
            const validTypes = ['application/json', 'text/plain'];
            const validExtensions = ['.json', '.txt'];
            const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
            
            if (!validTypes.includes(file.type) && !validExtensions.includes(fileExtension)) {
                showError('Invalid file type. Please upload a JSON or text file.');
                fileInfo.style.display = 'none';
                return;
            }
            
            reader.onload = (e) => {
                inputArea.value = e.target.result;
                formatJSON(2);
                
                // Hide file info after successful load
                setTimeout(() => {
                    fileInfo.style.display = 'none';
                }, 3000);
                
                // Show success feedback
                showSuccess(`File "${file.name}" loaded successfully`);
            };
            
            reader.onerror = () => {
                showError('Failed to read file. Please try again.');
                fileInfo.style.display = 'none';
            };
            
            reader.readAsText(file);
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function showSuccess(message) {
            // Create success toast
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-emerald-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 flex items-center gap-2';
            toast.innerHTML = `<i data-lucide="check-circle" class="w-4 h-4"></i><span class="text-sm">${message}</span>`;
            document.body.appendChild(toast);
            lucide.createIcons();
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function showError(message) {
            // Create error toast
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-red-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 flex items-center gap-2';
            toast.innerHTML = `<i data-lucide="alert-circle" class="w-4 h-4"></i><span class="text-sm">${message}</span>`;
            document.body.appendChild(toast);
            lucide.createIcons();
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 3000);
            }, 5000);
        }

        // Enhanced Drag & Drop
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        // Add visual feedback for drag states
        dropZone.addEventListener('dragenter', (e) => {
            dropZone.classList.add('drag-over');
            document.getElementById('drag-overlay').classList.remove('hidden');
            document.getElementById('drag-overlay').classList.add('flex');
        });

        dropZone.addEventListener('dragover', (e) => {
            dropZone.classList.add('drag-over');
        });

        dropZone.addEventListener('dragleave', (e) => {
            // Only remove if leaving the drop zone entirely
            if (e.relatedTarget && !dropZone.contains(e.relatedTarget)) {
                dropZone.classList.remove('drag-over');
                document.getElementById('drag-overlay').classList.add('hidden');
                document.getElementById('drag-overlay').classList.remove('flex');
            }
        });

        dropZone.addEventListener('drop', (e) => {
            dropZone.classList.remove('drag-over');
            document.getElementById('drag-overlay').classList.add('hidden');
            document.getElementById('drag-overlay').classList.remove('flex');
            
            const dt = e.dataTransfer;
            const files = dt.files;
            
            if (files.length > 0) {
                // Handle multiple files (take the first valid JSON file)
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const validExtensions = ['.json', '.txt'];
                    const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
                    
                    if (validExtensions.includes(fileExtension)) {
                        readFile(file);
                        break;
                    }
                }
            }
        });

        // Add keyboard support for drag operations
        dropZone.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                // Cancel drag operation
                dropZone.classList.remove('drag-over');
                document.getElementById('drag-overlay').classList.add('hidden');
                document.getElementById('drag-overlay').classList.remove('flex');
            }
        });

        // Add paste support
        dropZone.addEventListener('paste', (e) => {
            e.preventDefault();
            const text = e.clipboardData.getData('text');
            if (text) {
                inputArea.value = text;
                formatJSON(2);
                showSuccess('JSON pasted successfully');
            }
        });

        // --- UI & View Management ---

        function switchView(view) {
            const textView = document.getElementById('json-output');
            const treeView = document.getElementById('json-tree-view');
            const treeControls = document.getElementById('tree-controls');
            const tabText = document.getElementById('tab-text');
            const tabTree = document.getElementById('tab-tree');

            if (view === 'text') {
                textView.classList.remove('hidden');
                treeView.classList.add('hidden');
                treeControls.classList.add('hidden');

                tabText.classList.add('shadow-sm', 'bg-white', 'dark:bg-neutral-800', 'border-neutral-200', 'dark:border-neutral-700');
                tabText.classList.remove('border-transparent');

                tabTree.classList.remove('shadow-sm', 'bg-white', 'dark:bg-neutral-800', 'border-neutral-200', 'dark:border-neutral-700');
                tabTree.classList.add('border-transparent');
            } else {
                if (currentMode !== 'json') {
                    showError("Tree view is only available for JSON");
                    return;
                }
                // Try to render tree, might fail if invalid JSON in output
                try {
                    renderTree(inputArea.value); // Re-render from input to be safe
                } catch (e) {
                    showError("Valid JSON required for tree view");
                    return;
                }

                textView.classList.add('hidden');
                treeView.classList.remove('hidden');
                treeControls.classList.remove('hidden');
                treeControls.classList.add('flex');

                tabTree.classList.add('shadow-sm', 'bg-white', 'dark:bg-neutral-800', 'border-neutral-200', 'dark:border-neutral-700');
                tabTree.classList.remove('border-transparent');

                tabText.classList.remove('shadow-sm', 'bg-white', 'dark:bg-neutral-800', 'border-neutral-200', 'dark:border-neutral-700');
                tabText.classList.add('border-transparent');
            }
        }

        // Improved Tree Rendering with Details/Summary
        function renderTree(jsonStr) {
            try {
                const data = JSON.parse(jsonStr);
                const treeView = document.getElementById('json-tree-view');
                treeView.innerHTML = createTreeNode('root', data, true);
                lucide.createIcons();
            } catch (e) {
                // Silent catch for tree view
            }
        }

        function createTreeNode(key, value, isRoot = false) {
            if (value === null) return `<div class="ml-4"><span class="json-key">"${key}"</span>: <span class="json-null">null</span></div>`;

            const isArray = Array.isArray(value);
            const isObject = typeof value === 'object';

            if (isObject) {
                const isEmpty = isArray ? value.length === 0 : Object.keys(value).length === 0;
                const openBracket = isArray ? '[' : '{';
                const closeBracket = isArray ? ']' : '}';

                if (isEmpty) {
                    return `<div class="ml-4"><span class="json-key">"${key}"</span>: <span class="object-brace">${openBracket}${closeBracket}</span></div>`;
                }

                let html = `<details open class="ml-4 group">
                    <summary class="hover:bg-black/5 dark:hover:bg-white/5 rounded px-1 -ml-1">
                        <span class="json-key">"${key}"</span>: <span class="object-brace">${openBracket}</span>
                        <span class="text-neutral-400 text-[10px] ml-2">${isArray ? value.length + ' items' : Object.keys(value).length + ' keys'}</span>
                    </summary>
                    <div class="border-l border-neutral-200 dark:border-neutral-800 ml-1 pl-1">`;

                if (isArray) {
                    value.forEach((item, index) => {
                        html += typeof item === 'object' && item !== null
                            ? createTreeNode(index, item)
                            : `<div class="ml-4"><span class="text-neutral-400 text-xs mr-2">${index}:</span>${formatPrimitive(item)}</div>`;
                    });
                } else {
                    Object.entries(value).forEach(([k, v]) => {
                        html += typeof v === 'object' && v !== null
                            ? createTreeNode(k, v)
                            : `<div class="ml-4"><span class="json-key">"${k}"</span>: ${formatPrimitive(v)}</div>`;
                    });
                }

                html += `</div><div class="ml-4 object-brace">${closeBracket}</div></details>`;
                return html;
            }

            return `<div class="ml-4"><span class="json-key">"${key}"</span>: ${formatPrimitive(value)}</div>`;
        }

        function formatPrimitive(v) {
            if (typeof v === 'string') return `<span class="json-string">"${v}"</span>`;
            if (typeof v === 'number') return `<span class="json-number">${v}</span>`;
            if (typeof v === 'boolean') return `<span class="json-boolean">${v}</span>`;
            return `<span class="json-null">null</span>`;
        }

        // Tree Controls
        function expandAll() {
            document.querySelectorAll('#json-tree-view details').forEach(el => el.open = true);
        }

        function collapseAll() {
            document.querySelectorAll('#json-tree-view details').forEach(el => el.open = false);
        }

        function filterTree(query) {
            const treeView = document.getElementById('json-tree-view');
            if (!query) {
                treeView.querySelectorAll('.hidden-node').forEach(el => el.classList.remove('hidden-node'));
                treeView.querySelectorAll('.search-highlight').forEach(el => el.classList.remove('search-highlight'));
                return;
            }

            query = query.toLowerCase();
            expandAll();

            const walker = document.createTreeWalker(treeView, NodeFilter.SHOW_TEXT, null, false);
            let node;
            while (node = walker.nextNode()) {
                const text = node.textContent.toLowerCase();
                const parent = node.parentElement;
                if (text === '{' || text === '}' || text === '[' || text === ']') continue;

                if (text.includes(query)) {
                    parent.classList.add('search-highlight');
                } else {
                    parent.classList.remove('search-highlight');
                }
            }
        }


        // --- Utilities ---

        function displayOutput(text, type) {
            outputArea.value = text;
            document.getElementById('status-badge').textContent = 'Valid';
            document.getElementById('status-badge').classList.remove('hidden');

            const formatBadge = document.getElementById('format-badge');
            formatBadge.textContent = type;
            formatBadge.classList.remove('hidden');

            dismissError();
        }

        function showError(message, isRealtime = false) {
            const banner = document.getElementById('top-error-banner');
            const msgEl = document.getElementById('top-error-message');

            msgEl.textContent = message;
            banner.classList.remove('hidden');

            // Hide valid badges
            document.getElementById('status-badge').classList.add('hidden');
            document.getElementById('format-badge').classList.add('hidden');
        }

        function dismissError() {
            document.getElementById('top-error-banner').classList.add('hidden');
        }

        function updateStats() {
            const input = inputArea.value;
            document.getElementById('input-stats').textContent = input.length + ' chars';
        }

        function clearAll() {
            inputArea.value = '';
            outputArea.value = '';
            inputArea.classList.remove('valid-json', 'invalid-json');
            document.getElementById('realtime-status').classList.add('hidden');
            dismissError();
            document.getElementById('status-badge').classList.add('hidden');
            document.getElementById('format-badge').classList.add('hidden');
            localStorage.removeItem('json_input_backup');
            updateStats();
        }

        function loadSample() {
            const sample = {
                "name": "Super Hero Squad",
                "formed": 2016,
                "secretBase": "Super tower",
                "active": true,
                "members": [
                    {
                        "name": "Molecule Man",
                        "age": 29,
                        "secretIdentity": "Dan Jukes",
                        "powers": ["Radiation resistance", "Turning tiny", "Radiation blast"]
                    },
                    {
                        "name": "Madame Uppercut",
                        "age": 39,
                        "secretIdentity": "Jane Wilson",
                        "powers": ["Million tonne punch", "Damage resistance", "Superhuman reflexes"]
                    }
                ]
            };
            inputArea.value = JSON.stringify(sample, null, 2);
            formatJSON(2);
        }

        function downloadOutput() {
            const output = outputArea.value;
            if (!output) return showError('No output to download');

            let type = 'application/json';
            let ext = 'json';
            if (currentMode === 'yaml') { type = 'text/yaml'; ext = 'yaml'; }
            if (currentMode === 'csv') { type = 'text/csv'; ext = 'csv'; }
            if (currentMode === 'ts') { type = 'text/plain'; ext = 'ts'; }

            const blob = new Blob([output], { type: type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `data.${ext}`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function copyOutput() {
            const output = outputArea.value;
            if (!output) return;
            navigator.clipboard.writeText(output).then(() => {
                const btn = document.getElementById('copy-btn');
                const original = btn.innerHTML;
                btn.innerHTML = '<i data-lucide="check" class="w-3.5 h-3.5 text-emerald-600"></i>';
                setTimeout(() => {
                    btn.innerHTML = '<i data-lucide="copy" class="w-3.5 h-3.5"></i>';
                    lucide.createIcons();
                }, 2000);
                lucide.createIcons();
            });
        }
    </script>
</body>

</html>